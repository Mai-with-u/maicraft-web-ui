# Maicraft-Next 记忆查看器

## 概述

记忆查看器是Maicraft-Web-UI的一个功能组件，用于实时查看和管理Maicraft-Next AI代理的记忆系统。该组件基于记忆API（参考`docs/api/memory.md`）实现，支持四种类型的记忆：思维、对话、决策和经验。

## 功能特性

### 🔗 实时连接管理
- WebSocket连接状态监控
- 自动重连机制
- 连接状态实时显示

### 📊 记忆订阅与推送
- 支持按记忆类型过滤订阅（思维/对话/决策/经验）
- 支持按重要性级别过滤（高/正常/低）
- 实时接收记忆推送更新
- 推送计数统计

### 🔍 记忆查询
- 支持多类型记忆查询
- 可配置查询结果数量限制
- 支持重要性过滤
- 查询状态反馈

### ➕ 记忆管理
- **添加记忆**：支持添加四种类型的记忆条目
- **查看详情**：完整显示记忆内容和上下文信息
- **删除记忆**：支持单个和批量删除记忆
- **编辑记忆**：预留编辑功能接口（待实现）

### 📋 数据展示
- 使用DataTable组件展示记忆列表
- 支持排序、分页和搜索
- 记忆类型和重要性可视化标签
- 时间戳格式化显示
- 内容预览和上下文摘要

## 页面布局

### 状态栏
显示连接状态、订阅状态、记忆统计和最后更新时间。

### 控制面板
- **订阅设置**：选择要订阅的记忆类型和重要性级别
- **查询设置**：配置查询参数和过滤条件
- **操作按钮**：订阅/取消订阅、查询、清空列表

### 记忆列表
- 表格形式展示所有记忆条目
- 支持多选操作
- 每行显示：类型、重要性、时间、内容预览、上下文、操作按钮

### 对话框
- **添加记忆**：表单输入新记忆
- **记忆详情**：完整显示记忆信息

## API集成

### 订阅记忆
```json
{
  "type": "subscribe",
  "dataTypes": ["memory"],
  "updateInterval": 0,
  "filters": {
    "memoryTypes": ["thought", "decision"],
    "importance": "high"
  }
}
```

### 查询记忆
```json
{
  "type": "memory_query",
  "data": {
    "memoryTypes": ["thought", "conversation"],
    "limit": 50,
    "filters": {
      "importance": "high"
    }
  }
}
```

### 添加记忆
```json
{
  "type": "memory_add",
  "data": {
    "memoryType": "experience",
    "entry": {
      "lesson": "铁矿通常在Y=12层分布",
      "context": "mining_exploration",
      "confidence": 0.9
    }
  }
}
```

### 删除记忆
```json
{
  "type": "memory_delete",
  "data": {
    "memoryType": "thought",
    "id": "1704067200000_abc123def"
  }
}
```

## 使用方法

1. **访问页面**：通过主页的"查看记忆"按钮或直接访问 `/maicraft-next/memory`

2. **连接服务器**：
   - 点击"连接服务器"按钮建立WebSocket连接
   - 观察连接状态指示器

3. **订阅记忆**：
   - 选择要订阅的记忆类型（思维/对话/决策/经验）
   - 可选择重要性过滤
   - 点击"订阅记忆"按钮

4. **查看记忆**：
   - 实时接收推送的记忆数据
   - 或手动点击"查询记忆"获取历史数据
   - 使用搜索框过滤内容

5. **管理记忆**：
   - 点击"添加记忆"创建新条目
   - 点击"查看"查看完整记忆详情
   - 选择记忆条目后可批量删除

## 技术实现

### 组件结构
- `MaicraftNextMemoryViewer.vue`：主页面组件
- 集成`DataTable.vue`组件用于数据展示
- 使用`maicraftNextWebSocket.ts`服务管理连接

### 响应式数据
- 记忆列表：`memories`
- 连接状态：`isConnected`
- 订阅状态：`subscribedTypes`
- 推送计数：`pushCount`

### 事件处理
- WebSocket消息监听和解析
- 记忆数据实时更新
- 用户操作响应和反馈

## 样式设计

采用Element Plus组件库风格：
- 卡片式布局
- 响应式设计
- 状态指示器动画
- 标签色彩区分记忆类型
- 对话框交互友好

## 注意事项

- 记忆数据会实时推送，可能影响页面性能
- 大量记忆数据建议定期清理
- 删除操作不可恢复，请谨慎操作
- 编辑功能目前为预留接口，暂未实现

## 未来扩展

- 记忆编辑功能实现
- 记忆导出/导入功能
- 记忆分类和标签管理
- 记忆关联和图谱可视化
- 记忆统计和分析图表
